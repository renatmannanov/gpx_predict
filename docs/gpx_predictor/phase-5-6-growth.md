# –§–∞–∑—ã 5-6: Growth, Monetization, Crowdsourced

---

## –§–∞–∑–∞ 5: Growth & Monetization

**–¶–µ–ª—å:** –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ayda Run, –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

### –®–∞–≥–∏

#### –®–∞–≥ 1: Share Features
- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞ (Pillow/Cairo)
- Shareable comparison images
- Social-friendly format

#### –®–∞–≥ 2: Ayda Run Integration
- CTA to main app
- UTM tracking
- Cross-promotion
- Deep links

#### –®–∞–≥ 3: Freemium –º–æ–¥–µ–ª—å
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑
- Premium: –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑, –∏—Å—Ç–æ—Ä–∏—è, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- Payment integration

#### –®–∞–≥ 4: Analytics & Optimization
- Usage analytics
- Conversion tracking
- A/B tests setup
- Performance optimization

### Deliverables

- [ ] –ö–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ayda Run (CTA, deep links)
- [ ] Freemium subscription
- [ ] Analytics dashboard

---

## –§–∞–∑–∞ 6: Crowdsourced –ø–æ–∫—Ä—ã—Ç–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¶–µ–ª—å:** –£–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

> –≠—Ç–∞ —Ñ–∞–∑–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ —Ñ–æ—Ä–º—É–ª–∞—Ö Naismith/Minetti,
> crowdsourced –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –®–∞–≥–∏

#### –®–∞–≥ 1: Geo-indexed —Å–µ–≥–º–µ–Ω—Ç—ã
- Geohash —Å–∏—Å—Ç–µ–º–∞
- PostgreSQL + PostGIS —Å—Ö–µ–º–∞ trail_segments
- –ë–∞–∑–æ–≤—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

#### –®–∞–≥ 2: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤
- UI —Ñ–æ—Ä–º—ã –æ—Ç–∑—ã–≤–∞ –ø–æ—Å–ª–µ –ø–æ—Ö–æ–¥–∞
- –í—ã–±–æ—Ä –ø–æ–∫—Ä—ã—Ç–∏—è (multi-select)
- –û—Ç–º–µ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ

#### –®–∞–≥ 3: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ —Ç–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è
- –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å (–ª–µ—Ç–æ/–∑–∏–º–∞)
- –ü–µ—Ä–µ—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (cron job)

#### –®–∞–≥ 4: Matching GPX —Ñ–∞–π–ª–æ–≤
- Route fingerprinting
- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ

#### –®–∞–≥ 5: Surface-aware –ø—Ä–æ–≥–Ω–æ–∑
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é
- –û—Å–æ–±–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–ø—É—Å–∫–æ–≤
- Confidence scoring

#### –®–∞–≥ 6: OSM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Fallback –Ω–∞ OpenStreetMap
- –ú–∞–ø–ø–∏–Ω–≥ OSM —Ç–µ–≥–æ–≤
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

#### –®–∞–≥ 7 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): Gamification
- –ë–µ–π–¥–∂–∏ –∑–∞ –æ—Ç–∑—ã–≤—ã ("Trail Scout")
- –¢–æ–ø –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Deliverables

- [ ] –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–Ω–µ –∫ —Ñ–∞–π–ª—É)
- [ ] –°–µ–∑–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–µ—Ç–æ/–∑–∏–º–∞)
- [ ] Surface-aware –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OSM –∫–∞–∫ fallback
- [ ] Matching –Ω–æ–≤—ã—Ö GPX –∫ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º

---

## Share Image Generator

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üèîÔ∏è AYDA RUN PREDICTOR                                  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ú–∞—Ä—à—Ä—É—Ç: –ö–æ–∫-–ñ–∞–π–ª—è—É                                    ‚îÇ
‚îÇ  12 –∫–º  ‚Ä¢  +680–º  ‚Ä¢  –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å                  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ [–ü—Ä–æ—Ñ–∏–ª—å –≤—ã—Å–æ—Ç—ã - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è]                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ú–æ–π –ø—Ä–æ–≥–Ω–æ–∑: 5:30                                      ‚îÇ
‚îÇ  –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ç–∞—Ä—Ç: 07:00                             ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  predictor.ayda.run                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```python
from PIL import Image, ImageDraw, ImageFont
import io

def generate_share_image(prediction: HikePrediction) -> bytes:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞"""

    # –†–∞–∑–º–µ—Ä –¥–ª—è Instagram/Telegram
    width, height = 1080, 1080

    img = Image.new('RGB', (width, height), color='#1a1a2e')
    draw = ImageDraw.Draw(img)

    # –®—Ä–∏—Ñ—Ç—ã
    title_font = ImageFont.truetype("fonts/Roboto-Bold.ttf", 48)
    text_font = ImageFont.truetype("fonts/Roboto-Regular.ttf", 32)

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    draw.text((50, 50), "AYDA RUN PREDICTOR", font=title_font, fill='#ffffff')

    # –ú–∞—Ä—à—Ä—É—Ç
    draw.text((50, 150), prediction.route_name, font=title_font, fill='#4ecca3')

    # –ú–µ—Ç—Ä–∏–∫–∏
    metrics = f"{prediction.distance_km} –∫–º  ‚Ä¢  +{prediction.elevation_gain}–º"
    draw.text((50, 220), metrics, font=text_font, fill='#cccccc')

    # –ü—Ä–æ–≥–Ω–æ–∑
    time_str = format_time(prediction.estimated_time_hours)
    draw.text((50, 400), f"–ü—Ä–æ–≥–Ω–æ–∑: {time_str}", font=title_font, fill='#ffffff')

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    buffer = io.BytesIO()
    img.save(buffer, format='PNG')
    return buffer.getvalue()
```

---

## Freemium –º–æ–¥–µ–ª—å

### –¢–∞—Ä–∏—Ñ—ã

| –§—É–Ω–∫—Ü–∏—è | Free | Premium |
|---------|------|---------|
| –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ | ‚úÖ | ‚úÖ |
| –ó–∞–≥—Ä—É–∑–∫–∞ GPX | 3/–º–µ—Å—è—Ü | ‚àû |
| –ü–æ—Å–µ–≥–º–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ | ‚ùå | ‚úÖ |
| –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ | 5 | ‚àû |
| –ì—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑ | 2 —á–µ–ª | ‚àû |
| Share images | Watermark | –ë–µ–∑ watermark |
| Strava –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚ùå | ‚úÖ |

### –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

| –ü–ª–∞–Ω | –¶–µ–Ω–∞ (KZT) | –¶–µ–Ω–∞ (USD) |
|------|------------|------------|
| Free | 0 | 0 |
| Monthly | 1990 | ~4 |
| Annual | 14990 | ~30 |

---

## Crowdsourced Trail Data

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```python
@dataclass
class TrailSegment:
    id: str
    geohash: str              # Geo-–∏–Ω–¥–µ–∫—Å
    center_lat: float
    center_lon: float
    surface_votes: dict       # {"gravel": 5, "rock": 2}
    difficulty_votes: dict    # {"easy": 3, "hard": 1}
    seasonal_data: dict       # {"summer": {...}, "winter": {...}}
    last_updated: datetime
    contributors_count: int

class SurfaceType(Enum):
    ASPHALT = "asphalt"       # 1.0x
    GRAVEL = "gravel"         # 1.05x
    DIRT = "dirt"             # 1.1x
    GRASS = "grass"           # 1.15x
    ROCK = "rock"             # 1.2x
    SNOW = "snow"             # 1.4x
    MUD = "mud"               # 1.5x
```

### –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤

```python
class TrailFeedback(BaseModel):
    gpx_file_id: str
    segments: List[SegmentFeedback]
    overall_difficulty: str
    conditions: str           # "dry", "wet", "snowy"
    date: date

class SegmentFeedback(BaseModel):
    start_km: float
    end_km: float
    surface: SurfaceType
    difficulty: str           # "easy", "moderate", "hard"
    notes: Optional[str]

@router.post("/feedback/trail")
async def submit_trail_feedback(feedback: TrailFeedback):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–∑—ã–≤ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞"""

    for segment in feedback.segments:
        geohash = calculate_geohash(segment.start_km, gpx_file_id)

        await upsert_trail_segment(
            geohash=geohash,
            surface=segment.surface,
            difficulty=segment.difficulty,
            date=feedback.date
        )
```

### Geohash —Å–∏—Å—Ç–µ–º–∞

```python
import geohash

def calculate_geohash(lat: float, lon: float, precision: int = 7) -> str:
    """
    Precision 7 = ~150m x 150m –∫–≤–∞–¥—Ä–∞—Ç
    –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è trail segments
    """
    return geohash.encode(lat, lon, precision)

def get_nearby_segments(lat: float, lon: float) -> List[TrailSegment]:
    """–ù–∞—Ö–æ–¥–∏—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –≤ —Ä–∞–¥–∏—É—Å–µ"""

    center_hash = calculate_geohash(lat, lon)
    neighbors = geohash.neighbors(center_hash)

    return await db.trail_segments.find({
        "geohash": {"$in": [center_hash] + neighbors}
    }).to_list()
```

---

## –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π

```
‚ñ° HTTPS –≤–µ–∑–¥–µ
‚ñ° –¢–æ–∫–µ–Ω—ã Strava –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã (–ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
‚ñ° Rate limiting –Ω–∞ API (in-memory –¥–ª—è MVP)
‚ñ° Error handling –∏ logging
‚ñ° Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
‚ñ° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, uptime)
‚ñ° Open-Elevation API fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

### –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π (–¥–ª—è Strava)

```
‚ñ° Privacy Policy –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞
‚ñ° Consent screen –¥–ª—è Strava OAuth
‚ñ° –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ"
‚ñ° –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫–ª—é—á–∏—Ç—å Strava"
‚ñ° 7-day TTL –¥–ª—è Strava –∫—ç—à–∞
‚ñ° –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API Agreement –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
‚ñ° –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å crowdsourced –¥–∞–Ω–Ω—ã—Ö
```

### –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π

```
‚ñ° –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Strava (fallback)
‚ñ° –†–µ–∂–∏–º –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ñ° –†–µ–∂–∏–º –¥–ª—è –±–µ–≥—É–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ñ° –ì—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ñ° Share images –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
‚ñ° Telegram Mini App —Ä–∞–±–æ—Ç–∞–µ—Ç
```
