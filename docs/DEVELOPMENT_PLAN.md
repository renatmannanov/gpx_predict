# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ GPX Predictor

**–°–æ–∑–¥–∞–Ω:** 2025-01-15
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–±–æ—Ç–µ

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–°–µ—Ä–≤–∏—Å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Ö–æ–¥–æ–≤/–∑–∞–±–µ–≥–æ–≤ —Å —É—á—ë—Ç–æ–º —Ä–µ–ª—å–µ—Ñ–∞.
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–¢—É—Ä–∏—Å—Ç—ã ‚Üí –ë–µ–≥—É–Ω—ã ‚Üí Strava**

### –†–µ—à–µ–Ω–∏—è –∏–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è:
- –ë–î: **PostgreSQL** –≤–µ–∑–¥–µ (–ª–æ–∫–∞–ª—å–Ω–æ –∏ Railway)
- –ë–æ—Ç: **–û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å**, –≤—ã–∑—ã–≤–∞–µ—Ç API –±—ç–∫–µ–Ω–¥–∞
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: **Telegram ID** –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Sunrise/sunset: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **astral** –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
- Segment breakdown: –ø–æ **–≥—Ä–∞–¥–∏–µ–Ω—Ç—É + –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏**
- –§—Ä–æ–Ω—Ç–µ–Ω–¥: –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Ñ–æ–∫—É—Å –Ω–∞ –±—ç–∫–µ–Ω–¥ + –±–æ—Ç

---

## –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ –≤ –∫–æ–¥–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|-----------|--------|------|
| FastAPI scaffold | ‚úÖ | `backend/app/main.py` |
| SQLAlchemy –º–æ–¥–µ–ª–∏ | ‚úÖ | `backend/app/models/` |
| GPX –ø–∞—Ä—Å–∏–Ω–≥ | ‚úÖ | `backend/app/services/gpx_parser.py` |
| Naismith –∞–ª–≥–æ—Ä–∏—Ç–º | ‚úÖ | `backend/app/services/naismith.py` |
| –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è | ‚úÖ | `backend/app/services/naismith.py` |
| Predict hike –ª–æ–≥–∏–∫–∞ | ‚úÖ | `backend/app/services/prediction.py` |
| Predict group –ª–æ–≥–∏–∫–∞ | ‚úÖ | `backend/app/services/prediction.py` |
| GPX upload endpoint | üü° | –ü–∞—Ä—Å–∏—Ç, –Ω–æ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î |
| Predict endpoint | üü° | –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ hardcoded GPX –¥–∞–Ω–Ω—ã–µ |

---

## –≠—Ç–∞–ø 1: Backend ‚Äî –ë–î –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1.1 GPX upload ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- [x] –°–æ–∑–¥–∞—Ç—å GPX —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`backend/app/repositories/gpx.py`)
- [x] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ GPX –≤ —Ç–∞–±–ª–∏—Ü—É `gpx_files`
- [x] –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–∞–º —Ñ–∞–π–ª (–≤ –ë–î –∫–∞–∫ bytes) ‚Äî –∫–æ–ª–æ–Ω–∫–∞ `gpx_content`
- [x] –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `gpx_id` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- [x] Endpoint GET `/gpx/{gpx_id}` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ

### 1.2 Predict ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ GPX –∏–∑ –ë–î
- [x] –ó–∞–≥—Ä—É–∂–∞—Ç—å GPX –¥–∞–Ω–Ω—ã–µ –ø–æ `gpx_id` –≤ `predict_hike()`
- [x] –ó–∞–≥—Ä—É–∂–∞—Ç—å GPX –¥–∞–Ω–Ω—ã–µ –ø–æ `gpx_id` –≤ `predict_group()`
- [x] –£–±—Ä–∞—Ç—å hardcoded dummy –¥–∞–Ω–Ω—ã–µ

### 1.3 Segment breakdown
- [x] –§—É–Ω–∫—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ GPX –ø–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç—É + –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
- [x] –†–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç
- [x] –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç–≤–µ—Ç `HikePrediction.segments`

### 1.4 Sunrise/sunset
- [x] –î–æ–±–∞–≤–∏—Ç—å `astral` –≤ requirements.txt
- [x] –§—É–Ω–∫—Ü–∏—è `get_sun_times(lat, lon, date)`
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ warnings

### 1.5 Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å initial migration
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è PostgreSQL

---

## –≠—Ç–∞–ø 2: Telegram –±–æ—Ç ‚Äî MVP

### 2.1 Scaffold
- [x] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `bot/`
- [x] `bot/main.py` ‚Äî entry point
- [x] `bot/config.py` ‚Äî BOT_TOKEN, BACKEND_URL
- [x] `bot/requirements.txt`
- [x] `bot/.env.example`

### 2.2 –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- [x] `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- [x] `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞
- [x] `/cancel` ‚Äî –æ—Ç–º–µ–Ω–∞

### 2.3 GPX upload flow
- [x] Handler –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–∞
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä)
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ backend API
- [x] –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ –æ –º–∞—Ä—à—Ä—É—Ç–µ

### 2.4 –ü—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ inline keyboards
- [x] FSM states (`bot/states/prediction.py`)
- [x] Keyboards –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–ø—ã—Ç–∞
- [x] Keyboards –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä—é–∫–∑–∞–∫–∞
- [x] Keyboards –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ –≥—Ä—É–ø–ø—ã
- [x] –í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –¥–µ—Ç–µ–π/–ø–æ–∂–∏–ª—ã—Ö

### 2.5 –†–µ–∑—É–ª—å—Ç–∞—Ç
- [x] –í—ã–∑–æ–≤ backend `/predict/hike`
- [x] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- [x] –ü–æ–∫–∞–∑ warnings
- [x] –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞

### 2.6 API –∫–ª–∏–µ–Ω—Ç
- [x] `bot/services/api_client.py`
- [x] –ú–µ—Ç–æ–¥—ã: `upload_gpx()`, `predict_hike()`
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## –≠—Ç–∞–ø 3: –ì—Ä—É–ø–ø–æ–≤–æ–π —Ä–µ–∂–∏–º –≤ –±–æ—Ç–µ

### 3.1 –†–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —á–∞—Ç–∞ (–ª–∏—á–Ω—ã–π/–≥—Ä—É–ø–ø–∞)
- [ ] –†–∞–∑–Ω—ã–π UX –¥–ª—è –≥—Ä—É–ø–ø—ã

### 3.2 –°–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π
- [ ] –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç GPX
- [ ] –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
- [ ] –°–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤, —Å–≤—è–∑—å —Å –ø–æ—Ö–æ–¥–æ–º

### 3.3 –ì—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑
- [ ] –í—ã–∑–æ–≤ backend `/predict/group`
- [ ] –ü–æ–∫–∞–∑ —Ä–æ–ª–µ–π (–±—ã—Å—Ç—Ä—ã–π/—Å—Ä–µ–¥–Ω–∏–π/–º–µ–¥–ª–µ–Ω–Ω—ã–π)
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é

---

## –≠—Ç–∞–ø 4: –î–µ–ø–ª–æ–π

### 4.1 Railway setup
- [ ] PostgreSQL database
- [ ] Backend service
- [ ] Bot service
- [ ] Environment variables

### 4.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit tests –¥–ª—è Naismith
- [ ] Integration tests –¥–ª—è API
- [ ] E2E —Ç–µ—Å—Ç –±–æ—Ç–∞

---

## –ë—É–¥—É—â–∏–µ —ç—Ç–∞–ø—ã (–Ω–µ —Å–µ–π—á–∞—Å)

- **Peer Validation** ‚Äî –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø—ã—Ç–∞ –¥—Ä—É–∑—å—è–º–∏ (–æ–ø–∏—Å–∞–Ω–æ –≤ phase-2)
- **Telegram Mini App** ‚Äî –ø–æ—Å–ª–µ –±–æ—Ç–∞
- **–ë–∞–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ê–ª–º–∞—Ç—ã** ‚Äî –Ω—É–∂–Ω–æ –æ–±—Å—É–¥–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç
- **–†–µ–∂–∏–º –¥–ª—è –±–µ–≥—É–Ω–æ–≤** ‚Äî Riegel, GAP (–§–∞–∑–∞ 3)
- **Strava –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–§–∞–∑–∞ 4)
- **Crowdsourced –ø–æ–∫—Ä—ã—Ç–∏–µ** (–§–∞–∑–∞ 6)

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –ø–ª–∞–Ω–æ–º

1. –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —á–∞—Ç
2. –ì–æ–≤–æ—Ä–∏–º: "–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –ø–æ –ø–ª–∞–Ω—É –≤ `docs/DEVELOPMENT_PLAN.md`"
3. –Ø —á–∏—Ç–∞—é –ø–ª–∞–Ω, —Å–º–æ—Ç—Ä—é —á—Ç–æ –Ω–µ –æ—Ç–º–µ—á–µ–Ω–æ
4. –î–µ–ª–∞—é —Å–ª–µ–¥—É—é—â–∏–π –ø—É–Ω–∫—Ç
5. –û—Ç–º–µ—á–∞–µ–º `[x]` –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ

---

## –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –≠—Ç–∞–ø 3 ‚Äî –ì—Ä—É–ø–ø–æ–≤–æ–π —Ä–µ–∂–∏–º –≤ –±–æ—Ç–µ
