# Claude Code Rules for GPX Predict

## –í–æ–ø—Ä–æ—Å ‚â† –∑–∞–¥–∞—á–∞

- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å ‚Äî **–û–¢–í–ï–ß–ê–ô** –Ω–∞ –≤–æ–ø—Ä–æ—Å (—Ä–µ—Å–µ—Ä—á, –¥–∞–Ω–Ω—ã–µ, –∞–Ω–∞–ª–∏–∑)
- **–ù–ï** –Ω–∞—á–∏–Ω–∞–π –ø–∏—Å–∞—Ç—å/–º–µ–Ω—è—Ç—å –∫–æ–¥ –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –Ω–µ —Å–∫–∞–∂–µ—Ç "—Å–¥–µ–ª–∞–π", "–¥–æ–±–∞–≤—å", "–ø–æ–º–µ–Ω—è–π"
- –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ ‚Äî –æ–ø–∏—à–∏ —Å–ª–æ–≤–∞–º–∏, –¥–æ–∂–¥–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã

1. **–í–°–ï–ì–î–ê** —á–∏—Ç–∞–π `docs/ARCHITECTURE.md` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
2. **–í–°–ï–ì–î–ê** —á–∏—Ç–∞–π `docs/CALCULATIONS.md` –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ä–∞—Å—á—ë—Ç–æ–≤

---

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤

- –ï—Å–ª–∏ –ø–ª–∞–Ω –∑–∞–ø–∏—Å–∞–Ω –≤ —Ñ–∞–π–ª–µ (`docs/task_tracker/todo/`), **–í–°–ï–ì–î–ê** –∏–¥–∏ –ø–æ —Ñ–∞–π–ª—É –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É –ø—Ä–∞–≤–¥—ã
- –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á–∏ **–≤ –ø–æ—Ä—è–¥–∫–µ –∏–∑ —Ñ–∞–π–ª–∞**, –∞ –Ω–µ –ø–æ –ø–∞–º—è—Ç–∏
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–π —Ñ–∞–π–ª –ø–ª–∞–Ω–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–µ–ª–∞–µ—à—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ù–µ –ø—É—Ç–∞–π –Ω—É–º–µ—Ä–∞—Ü–∏—é —Ä–∞–∑–¥–µ–ª–æ–≤ ("–ó–∞–¥–∞—á–∏") —Å –ø–æ—Ä—è–¥–∫–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ("–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏")

## –ü–æ—Å–ª–µ compaction –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–µ—Ä–µ—á–∏—Ç–∞–π —Ñ–∞–π–ª –ø–ª–∞–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Ä–∞–±–æ—Ç–∞–µ—à—å
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–µ—Ä–µ—á–∏—Ç–∞–π —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—à—å
- –°–≤–µ—Ä—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –ø–ª–∞–Ω–æ–º –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ v2)

```
backend/app/
‚îú‚îÄ‚îÄ api/v1/routes/           # API endpoints
‚îú‚îÄ‚îÄ features/                # Feature-based modules (NEW!)
‚îÇ   ‚îú‚îÄ‚îÄ gpx/                 # GPX parsing & storage
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.py        # GPXParserService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ segmenter.py     # RouteSegmenter
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.py    # GPXRepository
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # GPXFile model
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hiking/              # Hiking predictions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculators/     # Tobler, Naismith calculators
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tobler.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ naismith.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ personalization.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # UserPerformanceProfile
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ trail_run/           # Trail running predictions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculators/     # GAP, fatigue calculators
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gap_calculator.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hike_run_threshold.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ runner_fatigue.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # UserRunProfile
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ strava/              # Strava integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py        # StravaClient
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync/            # Background sync
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # StravaToken, StravaActivity
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ users/               # User management
‚îÇ       ‚îî‚îÄ‚îÄ models.py        # User, Notification
‚îÇ
‚îú‚îÄ‚îÄ shared/                  # Shared utilities (NEW!)
‚îÇ   ‚îú‚îÄ‚îÄ geo.py               # haversine(), calculate_total_distance()
‚îÇ   ‚îú‚îÄ‚îÄ elevation.py         # smooth_elevations()
‚îÇ   ‚îú‚îÄ‚îÄ calculator_types.py  # MacroSegment, SegmentType, RouteComparison
‚îÇ   ‚îî‚îÄ‚îÄ formulas.py          # tobler_hiking_speed(), etc.
‚îÇ
‚îú‚îÄ‚îÄ services/                # Cross-feature services (legacy location)
‚îÇ   ‚îú‚îÄ‚îÄ prediction.py        # Main prediction orchestrator
‚îÇ   ‚îú‚îÄ‚îÄ naismith.py          # old_naismith (3rd calculation method!)
‚îÇ   ‚îú‚îÄ‚îÄ sun.py               # Sunrise/sunset calculations
‚îÇ   ‚îú‚îÄ‚îÄ user_profile.py      # Profile calculation service
‚îÇ   ‚îî‚îÄ‚îÄ calculators/
‚îÇ       ‚îú‚îÄ‚îÄ base.py          # Base calculator classes
‚îÇ       ‚îî‚îÄ‚îÄ comparison.py    # ComparisonService
‚îÇ
‚îú‚îÄ‚îÄ models/                  # SQLAlchemy models (re-exports)
‚îú‚îÄ‚îÄ schemas/                 # Pydantic schemas
‚îî‚îÄ‚îÄ repositories/            # Data access (re-exports)
```

---

## –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏

–í –ø—Ä–æ–µ–∫—Ç–µ **3 –º–µ—Ç–æ–¥–∞ —Ä–∞—Å—á—ë—Ç–∞ hiking** (–≤—Å–µ –Ω—É–∂–Ω—ã, –ù–ï —É–¥–∞–ª—è—Ç—å –∏ –ù–ï –æ–±—ä–µ–¥–∏–Ω—è—Ç—å):

| –ú–µ—Ç–æ–¥ | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `tobler` | `features/hiking/calculators/tobler.py` | Tobler's Hiking Function (1993) |
| `naismith` | `features/hiking/calculators/naismith.py` | Naismith + Langmuir corrections |
| `old_naismith` | `services/naismith.py` | Naismith + Tranter's corrections |

–û–Ω–∏ –¥–∞—é—Ç **—Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ:
```
tobler:       5—á 28–º–∏–Ω
naismith:     5—á 15–º–∏–Ω
old_naismith: 6—á 26–º–∏–Ω
```

**Trail Running** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `features/trail_run/calculators/gap_calculator.py` ‚Äî Grade Adjusted Pace

---

## –ó–∞–ø—Ä–µ—Ç—ã

- **–ù–ï** –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑ `shared/`:
  - `haversine` ‚Üí `shared/geo.py`
  - `elevation smoothing` ‚Üí `shared/elevation.py`
  - `tobler_hiking_speed` ‚Üí `shared/formulas.py`

- **–ù–ï** —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è token refresh/exchange ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `StravaClient`

- **–ù–ï** —Å–º–µ—à–∏–≤–∞—Ç—å sync/async Session –±–µ–∑ —è–≤–Ω–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

- **–ù–ï** —É–¥–∞–ª—è—Ç—å –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è

- **–ù–ï** –¥–µ–ª–∞—Ç—å Alembic revision ID –¥–ª–∏–Ω–Ω–µ–µ 32 —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî Alembic —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ `varchar(32)` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –§–æ—Ä–º–∞—Ç: `NNN_–∫—Ä–∞—Ç–∫–æ–µ_–æ–ø–∏—Å–∞–Ω–∏–µ` (–Ω–∞–ø—Ä–∏–º–µ—Ä `008_add_onboarding`, –Ω–µ `008_add_onboarding_and_notifications`)

---

## –ò–º–ø–æ—Ä—Ç—ã: –Ω–æ–≤—ã–µ –ø—É—Ç–∏

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–æ–≤—ã–µ –ø—É—Ç–∏)
from app.features.hiking.calculators import ToblerCalculator, NaismithCalculator
from app.features.trail_run.calculators import GAPCalculator
from app.features.gpx import GPXParserService, RouteSegmenter
from app.features.strava import StravaClient
from app.shared import haversine
from app.shared.formulas import tobler_hiking_speed

# –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (—Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ re-export, –Ω–æ –ª—É—á—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
from app.services.calculators import ToblerCalculator  # ‚Üí re-export
from app.models.user_profile import UserPerformanceProfile  # ‚Üí re-export
```

---

## Git Commits

**Commit messages must be in English only.**

Format: [Conventional Commits](https://www.conventionalcommits.org/)
```
<type>(<scope>): <description>

[optional body]
```

Examples:
```
feat(trail-run): add GAP calculation for entire route
fix(strava): handle token refresh edge case
refactor(hiking): extract shared utilities
docs: update ARCHITECTURE.md
```

Types: `feat`, `fix`, `refactor`, `docs`, `test`, `chore`

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ docs/

```
docs/
‚îú‚îÄ‚îÄ ARCHITECTURE.md          # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—á–∏—Ç–∞—Ç—å –í–°–ï–ì–î–ê)
‚îú‚îÄ‚îÄ CALCULATIONS.md          # –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á—ë—Ç–æ–≤ (—á–∏—Ç–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞—Å—á—ë—Ç–æ–≤)
‚îú‚îÄ‚îÄ insights/                # –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–æ–∫, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞) ‚Äî –ú–û–ñ–ù–û —á–∏—Ç–∞—Ç—å
‚îú‚îÄ‚îÄ shareable/               # –ü—Ä–æ–º–ø—Ç—ã/—à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ ‚Äî –ù–ï —á–∏—Ç–∞—Ç—å –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞
‚îî‚îÄ‚îÄ task_tracker/
    ‚îú‚îÄ‚îÄ todo/                # –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ –ø–ª–∞–Ω—ã ‚Äî –ú–û–ñ–ù–û —á–∏—Ç–∞—Ç—å
    ‚îú‚îÄ‚îÄ backlog/             # –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ ‚Äî –ú–û–ñ–ù–û —á–∏—Ç–∞—Ç—å
    ‚îú‚îÄ‚îÄ done/                # –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ ‚Äî –ù–ï —á–∏—Ç–∞—Ç—å –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îî‚îÄ‚îÄ archieve/            # –ù–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ ‚Äî –ù–ï —á–∏—Ç–∞—Ç—å –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–ö–†–ò–¢–ò–ß–ù–û:** –ù–ï –∑–∞—Ö–æ–¥–∏—Ç—å –≤ `docs/task_tracker/done/` –∏ `docs/task_tracker/archieve/` —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä—è–º–æ–º—É –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç–æ–∫–µ–Ω—ã.

---

## –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–¥–µ:

1. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö** ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å `docs/CALCULATIONS.md`
2. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ** ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å `docs/ARCHITECTURE.md`
3. **–ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã/–º–æ–¥–µ–ª–∏** ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ `docs/ARCHITECTURE.md`

---

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∏—á

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–ª–∞–Ω–∞

**–ö–†–ò–¢–ò–ß–ù–û:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–º–µ—Ä –ø–ª–∞–Ω–∞:
- –ï—Å–ª–∏ –ø–ª–∞–Ω > 300 —Å—Ç—Ä–æ–∫ ‚Äî **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —á–∞—Å—Ç–∏ (–º–∞–∫—Å–∏–º—É–º 200-300 —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥–∞—è)
- –ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π

–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
```
‚ö†Ô∏è –ü–ª–∞–Ω —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ({N} —Å—Ç—Ä–æ–∫).
–†–µ–∫–æ–º–µ–Ω–¥—É—é —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏:
- Part 1: {–Ω–∞–∑–≤–∞–Ω–∏–µ} (~X —Å—Ç—Ä–æ–∫)
- Part 2: {–Ω–∞–∑–≤–∞–Ω–∏–µ} (~Y —Å—Ç—Ä–æ–∫)
...
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–∂–¥–æ–π?
```

### –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞/—Ñ—É–Ω–∫—Ü–∏–∏ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø—Ä–æ–≤–µ—Ä—å:

1. **–ì–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è?**
   - [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã –≤ —ç—Ç–∏ –º–µ—Å—Ç–∞
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

2. **–ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –µ–≥–æ?**
   - [ ] –ï—Å–ª–∏ —ç—Ç–æ callback/hook ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
   - [ ] –ï—Å–ª–∏ —ç—Ç–æ middleware ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ü–µ–ø–æ—á–∫—É

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏:**
   - [ ] –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤ –º–æ–¥—É–ª–µ A –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ –º–æ–¥—É–ª—è B ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–∞ –º–æ–¥—É–ª—è

### –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

–ï—Å–ª–∏ –≤ –ø–ª–∞–Ω–µ –µ—Å—Ç—å —É—Å–ª–æ–≤–∏—è —Ç–∏–ø–∞:
- "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —à–∞–≥ –µ—Å–ª–∏..."
- "–ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞..."
- "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—Å–ª–∏ –µ—Å—Ç—å..."

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**
1. –Ø–≤–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —É—Å–ª–æ–≤–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±–µ –≤–µ—Ç–∫–∏ (if/else)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**

1. –ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø–ª–∞–Ω
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –ø–ª–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?
   - [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É flow?
   - [ ] –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è?

3. –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç:
```
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: [—Å–ø–∏—Å–æ–∫]
‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ: [—Å–ø–∏—Å–æ–∫ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏]
‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: [—Å–ø–∏—Å–æ–∫ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏]
```

### –ü—Ä–∞–≤–∏–ª–æ "–Ω–µ –∑–∞–±—É–¥—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å"

–°–æ–∑–¥–∞–ª —Ñ–∞–π–ª/—Ñ—É–Ω–∫—Ü–∏—é ‚Üí –ü—Ä–æ–≤–µ—Ä—å:
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –ª–∏ import –≤ `__init__.py`?
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ router –≤ main.py?
- [ ] –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ?
- [ ] –ï—Å—Ç—å –ª–∏ –ø—É—Ç—å –æ—Ç user action –¥–æ —ç—Ç–æ–≥–æ –∫–æ–¥–∞?

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ —Å–æ–∑–¥–∞–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PROGRESS_NOTIFICATION_INTERVAL = 30`):
- [ ] –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–Ω–∞ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –∫–æ–¥–µ
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è = –∑–∞–±—ã—Ç–∞—è –ª–æ–≥–∏–∫–∞

### –°–º–µ–Ω–∞ –ø–æ–¥—Ö–æ–¥–∞ / –ø–µ—Ä–µ–¥–µ–ª–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ö–†–ò–¢–ò–ß–ù–û:** –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–¥—Ö–æ–¥–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ê –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç –ë):

1. **–£–¥–∞–ª–∏—Ç—å –∫–æ–¥ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
   - [ ] –ù–∞–π—Ç–∏ –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
   - [ ] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏/handlers, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã
   - [ ] –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å "–º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞"

2. **–ü–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞ "—á–∏—Å—Ç–∞—è" –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–æ–∫
   - [ ] –ù–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–¥ "–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π"

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–¥–µ–ª–∫–∏:**
   ```
   –£–¥–∞–ª–µ–Ω–æ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
   - [—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∏] ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ

   –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
   - [—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∏] ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ
   ```

---

## –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–∏—á–∏)

**–ö–†–ò–¢–ò–ß–ù–û:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª—é–±–æ–π —Ñ–∏—á–∏ –ø—Ä–æ–π–¥–∏ —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç:

### –ö–æ–¥
- [ ] –í—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `__init__.py`
- [ ] –ù–æ–≤—ã–µ —Ä–æ—É—Ç—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ `main.py` / `router.py`
- [ ] –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ (–µ—Å—Ç—å –ø—É—Ç—å –æ—Ç user action –¥–æ –∫–æ–¥–∞)
- [ ] –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] `docs/ARCHITECTURE.md` –æ–±–Ω–æ–≤–ª—ë–Ω (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã/–º–æ–¥–µ–ª–∏)
- [ ] `docs/CALCULATIONS.md` –æ–±–Ω–æ–≤–ª—ë–Ω (–µ—Å–ª–∏ –º–µ–Ω—è–ª–∏—Å—å —Ä–∞—Å—á—ë—Ç—ã)
- [ ] –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–µ–∫—Ü–∏—é "–í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"

### –û—Ç—á—ë—Ç
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç:
```
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: [—Å–ø–∏—Å–æ–∫]
‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ: [—Å–ø–∏—Å–æ–∫ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏]
‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: [—Å–ø–∏—Å–æ–∫ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏]
üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –æ–±–Ω–æ–≤–ª–µ–Ω–∞/–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
```

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (TODO)

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞)
2. **Legacy re-exports** ‚Äî —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ re-export, –Ω–æ –Ω–æ–≤—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `features/` –∏ `shared/`
